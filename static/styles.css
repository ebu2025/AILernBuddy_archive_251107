:root{
  --bg:#0f1115; --panel:#141923; --border:#222a39; --fg:#e6e8ee; --muted:#9aa3b2;
  --accent:#6ea8fe; --accent2:#39d98a; --danger:#ff6b6b; --shadow:0 14px 40px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.5 "Inter",system-ui,Segoe UI,Roboto,Arial;-webkit-font-smoothing:antialiased;min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden;min-width:100vw}
.hidden{display:none!important}
.muted{color:var(--muted)}
.label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
.input{background:#0d1118;border:1px solid var(--border);color:var(--fg);border-radius:10px;padding:10px;width:100%;transition:border-color .2s,box-shadow .2s}
.input:focus{outline:none;border-color:#2f4870;box-shadow:0 0 0 2px rgba(110,168,254,.25)}
.btn{background:#1b2332;border:1px solid var(--border);color:var(--fg);padding:10px 14px;border-radius:10px;cursor:pointer;transition:background .2s,transform .2s;width:auto;display:inline-flex;align-items:center;justify-content:center;gap:6px;font-weight:500}
.btn:hover{background:#222a3b;transform:translateY(-1px)}
.btn.primary{background:var(--accent);border-color:#4c7bd9;color:#0b1220}
.btn.ghost{background:transparent}
.btn.danger{color:#ffdede;border-color:#6b2a2a}
.btn.full{width:100%}
.btn.small-btn{padding:6px 10px;font-size:13px}
.btn[disabled]{opacity:.6;cursor:not-allowed;transform:none}
.icon-btn{background:transparent;color:var(--muted);border:1px solid var(--border);border-radius:8px;padding:4px 8px;font-size:18px;line-height:1;cursor:pointer;transition:background .2s,color .2s}
.icon-btn:hover{background:#1c2331;color:var(--accent2)}

.auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px;width:100%}
.auth-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:24px;width:100%;max-width:360px;display:flex;flex-direction:column;gap:14px}
.auth-brand{display:flex;align-items:center;gap:12px}
.auth-card .logo{font-size:36px}
.auth-card .title{margin:0;font-size:26px}
.auth-card .subtitle{margin:0;color:var(--muted)}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-actions{display:flex;gap:12px;margin-top:6px}
.feedback{min-height:18px;font-size:13px}

.app-screen{display:flex;min-height:100vh;width:100%;flex:1 1 auto}
.history-panel{width:260px;flex:0 0 260px;background:#101521;border-right:1px solid var(--border);padding:20px 16px;display:flex;flex-direction:column;gap:18px;position:relative}
.history-brand{display:flex;align-items:center;gap:10px}
.history-brand .logo{font-size:26px}
.brand-title{font-weight:700}
.brand-subtitle{font-size:12px;color:var(--muted)}
.history-user{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#0d121b;border:1px solid var(--border);border-radius:12px}
.history-sections{flex:1;overflow:auto;display:flex;flex-direction:column;gap:18px}
.history-section{display:flex;flex-direction:column;gap:10px}
.history-header{display:flex;align-items:center;justify-content:space-between;font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:.05em}
.history-list{display:flex;flex-direction:column;gap:6px}
.history-item{background:#0b0f15;border:1px solid var(--border);border-radius:10px;padding:10px 12px;display:flex;flex-direction:column;gap:4px;cursor:pointer;transition:border-color .2s,background .2s}
.history-item:hover{border-color:#2a3650}
.history-item.active{border-color:var(--accent);background:rgba(110,168,254,.12)}
.history-item-title{font-weight:600;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.history-item-meta{font-size:12px;color:var(--muted)}

.workspace{flex:1;display:flex;flex-direction:column;padding:20px 24px;gap:16px;min-height:0}
.workspace-header{display:flex;align-items:flex-start;justify-content:space-between;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:18px 20px;box-shadow:var(--shadow);gap:16px}
.workspace-header-main{display:flex;flex-direction:column;gap:6px}
.workspace-header-side{display:flex;flex-direction:column;align-items:flex-end;gap:12px}
.workspace-tabs{display:flex;gap:8px}
.tab-btn{background:#131b2a;border:1px solid var(--border);color:var(--muted);padding:6px 14px;border-radius:999px;font-size:13px;cursor:pointer;transition:background .2s,color .2s}
.tab-btn.active{background:var(--accent);color:#0b1220;border-color:#4c7bd9;font-weight:600}
.tab-btn:hover{background:#1d2636;color:var(--fg)}
.workspace-title{font-size:24px;font-weight:700;margin-top:4px}
.workspace-subtitle{font-size:13px;margin-top:2px}
.workspace-session{display:flex;align-items:center;gap:10px;font-size:13px}

.workspace-body{flex:1;display:grid;grid-template-columns:1fr 280px;gap:20px;min-height:0;height:100%;width:100%}
.chat-column{display:flex;flex-direction:column;gap:14px;min-height:0}
.profile-column{display:flex;flex-direction:column;gap:16px;min-height:0}
.chat-header{display:flex;align-items:center;justify-content:space-between;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px 16px;box-shadow:var(--shadow)}
.chip{background:#0b1422;border:1px solid var(--border);padding:6px 12px;border-radius:999px;font-size:13px}
.status{color:var(--muted);font-size:13px}
.chat-log{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow);overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;max-height:100%;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain;touch-action:pan-y}
.msg{display:flex;gap:10px;margin:10px 0;max-width:82%}
.msg .bubble{padding:12px 14px;border-radius:16px;border:1px solid var(--border);word-break:break-word}
.msg.user{justify-content:flex-end;margin-left:auto}
.msg.user .bubble{background:#132033;border-color:#22324b;white-space:pre-wrap}
.msg.bot .bubble{background:#131a12;border-color:#223024;white-space:normal}
.msg.meta .bubble{background:#0d1118;color:var(--muted);white-space:pre-wrap}
.msg.bot .bubble h1,
.msg.bot .bubble h2,
.msg.bot .bubble h3,
.msg.bot .bubble h4,
.msg.bot .bubble h5,
.msg.bot .bubble h6{margin:0 0 8px;font-weight:600}
.msg.bot .bubble h1{font-size:20px}
.msg.bot .bubble h2{font-size:18px}
.msg.bot .bubble h3{font-size:16px}
.msg.bot .bubble ul{margin:8px 0;padding-left:20px}
.msg.bot .bubble li{margin:4px 0}
.msg.bot .bubble p{margin:0 0 8px}
.msg.bot .bubble p:last-child{margin-bottom:0}
.msg.bot .bubble br{line-height:1.6}
.msg.bot .bubble code{background:#0b0f15;border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:2px 6px;font-family:"Fira Code",monospace;font-size:13px}
.msg.bot .bubble pre{background:#0b0f15;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:12px;overflow:auto;font-family:"Fira Code",monospace;font-size:13px;margin:0 0 10px}
.msg.bot .bubble pre code{border:none;padding:0;background:transparent}
.loader{display:inline-block;width:13px;height:13px;border:2px solid var(--muted);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.composer{display:flex;gap:10px;align-items:flex-end}
textarea.input{resize:vertical;min-height:56px}

.control-column{display:flex;flex-direction:column;gap:16px;min-width:0}
.control-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
.control-card h3{margin:0;font-size:16px}
.control-group{display:flex;flex-direction:column;gap:6px}
.oversight-card{gap:10px}
.oversight-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
.oversight-status{min-height:18px}
.oversight-table-wrap{overflow-x:auto;border:1px solid var(--border);border-radius:12px}
.oversight-table{width:100%;border-collapse:collapse;font-size:13px;min-width:420px}
.oversight-table th,.oversight-table td{padding:10px 12px;text-align:left;border-bottom:1px solid var(--border);vertical-align:top}
.oversight-table th{color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:.04em;font-size:11px}
.oversight-table tr:last-child td{border-bottom:none}
.oversight-table tr.stuck{background:rgba(255,107,107,.06)}
.oversight-learner{font-weight:600;font-size:14px}
.oversight-meta{color:var(--muted);font-size:12px;margin-top:4px}
.reason-list{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.reason-chip{background:#1b2332;border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:11px;color:var(--muted)}
.oversight-actions{display:flex;flex-direction:column;gap:6px}
.oversight-actions .btn{justify-content:flex-start}
.override-meta{font-size:12px;color:var(--muted)}
.oversight-empty{text-align:center;color:var(--muted);padding:14px 0}
.sparkline{font-family:"Fira Code",monospace;font-size:16px;letter-spacing:-2px;color:var(--accent2);display:inline-block}
.sparkline-muted{color:var(--muted)}
.bloom-chip-row{display:flex;flex-wrap:wrap;gap:6px}
.bloom-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#10192a;border:1px solid var(--border);font-size:12px}
.bloom-chip .chip-score{color:var(--accent2);font-variant-numeric:tabular-nums;font-size:12px}
.bloom-chip .chip-label{font-weight:500}

.profile-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
.profile-header{display:flex;align-items:center;justify-content:space-between;gap:10px}
.profile-table{width:100%;border-collapse:collapse}
.profile-table th,.profile-table td{padding:10px 12px;text-align:left;border-bottom:1px solid var(--border);font-size:14px}
.profile-table th{color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:.04em;font-size:12px}
.profile-table tr:last-child td{border-bottom:none}
.profile-table td:nth-child(2),
.profile-table td:nth-child(3){font-variant-numeric:tabular-nums}
.profile-next-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:10px}
.profile-next-list li{background:#0f141e;border:1px solid var(--border);border-radius:12px;padding:10px 12px;display:flex;flex-direction:column;gap:6px}
.profile-next-list .next-title{font-weight:600}
.profile-next-list .next-reason{color:var(--muted);font-size:13px}
.profile-next-list .next-time{color:var(--muted);font-size:12px}
.profile-next-list .next-modality{color:var(--accent2);font-size:12px;font-weight:500}
.profile-next-list .next-preference-highlights{margin:0;padding-left:18px;color:var(--muted);font-size:12px;list-style:disc}
.profile-next-list .next-preference-highlights li{margin-bottom:2px}
.link-btn{background:none;border:none;color:var(--accent);cursor:pointer;padding:0;font-size:13px;font-weight:500}
.link-btn:hover{text-decoration:underline;color:var(--accent2)}
.small-text{font-size:12px}

.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#0d1118;border:1px solid var(--border);padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);z-index:50}

@media (max-width:1100px){
  .app-screen{flex-direction:column;min-height:0}
  .history-panel{width:100%;flex-direction:row;align-items:flex-start;overflow:auto;gap:16px}
  .history-sections{flex-direction:row;gap:12px;overflow-x:auto;max-height:200px}
  .history-section{min-width:220px}
  .workspace{padding:16px}
  .workspace-body{grid-template-columns:1fr;grid-template-rows:auto auto;min-height:0}
  .control-column{flex-direction:row;overflow-x:auto;flex-wrap:wrap;gap:12px}
  .control-card{min-width:240px}
}

@media (max-width:640px){
  .auth-card{padding:20px}
  .history-panel{padding:16px 12px}
  .workspace{padding:14px}
  .workspace-header{flex-direction:column;gap:12px}
  .workspace-header-side{align-items:flex-start}
  .workspace-body{gap:14px}
  .control-column{flex-direction:column;overflow-x:visible;gap:12px}
  .control-card{min-width:0;width:100%}
}

@media (max-width:480px){
  .history-panel{flex-direction:column;gap:12px}
  .history-sections{width:100%;flex-direction:column;max-height:none}
  .history-section{min-width:0}
  .workspace{padding:12px}
  .workspace-header{padding:14px}
  .workspace-body{gap:12px}
}
